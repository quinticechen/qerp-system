
# ERP 系統資料對應文件

## 系統模組與 Supabase 資料表對應關係

### 1. 儀表板 (/dashboard)
**主要功能：** 顯示系統概覽和統計資料

**相關資料表：**
- `orders` - 訂單統計
- `purchase_orders` - 採購統計  
- `inventories` - 庫存統計
- `shippings` - 出貨統計
- `customers` - 客戶數量
- `products_new` - 產品數量

**業務流程：**
- 聚合各模組數據顯示關鍵指標
- 提供快速導航到各功能模組

---

### 2. 產品管理 (/product)
**主要功能：** 管理產品基本資料

**主要資料表：**
- `products_new` (主表)
  - 產品名稱、顏色、規格、計量單位
  - 分類管理
  - 建立者和更新者追蹤

**相關資料表：**
- `stock_thresholds` - 庫存警告閾值設定
- `order_products` - 訂單中的產品關聯
- `purchase_order_items` - 採購單產品關聯
- `inventory_rolls` - 庫存卷料關聯

**業務流程：**
1. 新增/編輯產品基本資料
2. 設定庫存警告閾值
3. 查看產品在訂單/採購/庫存中的使用情況

---

### 3. 訂單管理 (/order)
**主要功能：** 客戶訂單全生命週期管理

**主要資料表：**
- `orders` (主表)
  - 訂單編號、狀態、付款狀態、出貨狀態
  - 客戶關聯、備註
- `order_products` (訂單產品明細)
  - 產品、數量、單價、規格

**相關資料表：**
- `customers` - 客戶資料
- `products_new` - 產品資料
- `purchase_orders` - 關聯的採購單
- `shippings` - 出貨記錄

**業務流程：**
1. 接收客戶訂單 → 建立 orders + order_products
2. 確認訂單 → 更新訂單狀態
3. 安排採購 → 建立關聯的 purchase_orders
4. 安排出貨 → 建立 shippings 記錄
5. 完成訂單 → 更新為已完成狀態

---

### 4. 採購管理 (/purchase)
**主要功能：** 向工廠採購原料的管理

**主要資料表：**
- `purchase_orders` (主表)
  - 採購單編號、工廠、訂單關聯
  - 狀態、預計到貨日期
- `purchase_order_items` (採購產品明細)
  - 產品、訂購數量、卷數、單價

**相關資料表：**
- `factories` - 工廠資料
- `products_new` - 產品資料
- `orders` - 關聯的客戶訂單
- `inventories` - 到貨後的庫存記錄

**業務流程：**
1. 根據訂單需求建立採購單
2. 發送給工廠確認
3. 追蹤採購進度和到貨狀態
4. 到貨後轉為庫存管理

---

### 5. 庫存管理 (/inventory)
**主要功能：** 原料庫存的精細化管理

**主要資料表：**
- `inventories` (庫存批次)
  - 採購單關聯、工廠、到貨日期
- `inventory_rolls` (庫存卷料明細)
  - 卷號、數量、品質等級、貨架位置
  - 分配狀態、規格詳情

**相關資料表：**
- `purchase_orders` - 採購來源
- `products_new` - 產品資料
- `warehouses` - 倉庫位置
- `shipping_items` - 出貨分配

**業務流程：**
1. 採購到貨 → 建立 inventories
2. 入庫分卷 → 建立 inventory_rolls
3. 品質檢驗 → 更新品質等級
4. 庫存分配 → 標記為已分配
5. 出貨扣減 → 更新當前數量

---

### 6. 出貨管理 (/shipping)
**主要功能：** 訂單履約和出貨執行

**主要資料表：**
- `shippings` (出貨單)
  - 出貨編號、客戶、訂單關聯
  - 出貨日期、總數量和卷數
- `shipping_items` (出貨明細)
  - 庫存卷料分配、出貨數量

**相關資料表：**
- `orders` - 訂單資料
- `customers` - 客戶資料
- `inventory_rolls` - 庫存卷料
- `shipment_history` - 出貨歷史記錄

**業務流程：**
1. 根據訂單安排出貨
2. 分配庫存卷料
3. 生成出貨單和包裝清單
4. 更新訂單出貨狀態
5. 記錄出貨歷史

---

### 7. 工廠管理 (/factory)
**主要功能：** 供應商工廠資料管理

**主要資料表：**
- `factories` (主表)
  - 工廠名稱、聯絡人、地址
  - 電話、電子郵件

**相關資料表：**
- `purchase_orders` - 採購訂單
- `inventories` - 庫存來源

**業務流程：**
1. 維護工廠基本資料
2. 評估工廠供應能力
3. 管理採購合作關係

---

### 8. 客戶管理 (/customer)
**主要功能：** 客戶資料和關係管理

**主要資料表：**
- `customers` (主表)
  - 客戶名稱、聯絡人、地址
  - 電話、電子郵件

**相關資料表：**
- `orders` - 客戶訂單
- `shippings` - 出貨記錄
- `shipment_history` - 出貨歷史

**業務流程：**
1. 維護客戶基本資料
2. 追蹤客戶訂單歷史
3. 分析客戶購買模式

---

### 9. 系統設定 (/system)
**主要功能：** 系統參數和基礎資料設定

**相關資料表：**
- `warehouses` - 倉庫設定
- `stock_thresholds` - 庫存警告設定
- 系統參數配置

**業務流程：**
1. 倉庫和貨架管理
2. 庫存警告閾值設定
3. 系統業務規則配置

---

### 10. 用戶管理 (/user)
**主要功能：** 用戶帳號和權限管理

**主要資料表：**
- `profiles` (主表)
  - 用戶基本資料、角色、狀態
  - 電話、全名

**權限控制：**
- `admin` - 系統管理員
- `sales` - 銷售人員
- `assistant` - 助理
- `accounting` - 會計
- `warehouse` - 倉庫管理員

## 資料流向圖

```
客戶訂單 → 訂單管理 → 採購管理 → 庫存管理 → 出貨管理
    ↓           ↓           ↓           ↓           ↓
customers → orders → purchase_orders → inventories → shippings
            ↓           ↓               ↓           ↓
    order_products → purchase_order_items → inventory_rolls → shipping_items
```

## 核心業務邏輯

1. **訂單驅動採購：** 根據客戶訂單需求自動計算採購需求
2. **庫存分配管理：** 精確追蹤每卷原料的分配和使用狀況
3. **品質分級：** 支援 A/B/C/D/defective 品質等級管理
4. **多狀態追蹤：** 訂單、採購、出貨的多階段狀態管理
5. **角色權限控制：** 基於用戶角色的功能存取控制

